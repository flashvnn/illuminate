<?php
/**
 * @file
 * Laravel Example.
 */

/**
 * Implements hook_menu().
 */
function illuminate_example_menu() {

  $items['illuminate-example'] = array(
    'title' => 'Laravel Example',
    'page callback' => 'illuminate_example_page',
    'page arguments' => array() ,
    'access arguments' => array(
      'access content'
    ) ,
  );

  $items['illuminate-example/%'] = array(
    'title' => 'Laravel Example',
    'page callback' => 'illuminate_example_detail_page',
    'page arguments' => array(1) ,
    'access arguments' => array(
      'access content'
    ) ,
  );

  return $items;
}

function illuminate_example_page(){
  $examples = array(
    'cache'        => "Cache Example",
    'yamlconfig'   => "YAML Config Example",
    'drupalassets' => "Drupal Assets Example",
    'drupalconfig' => "Drupal Config Example",
    'viewrender'   => "Laravel View Render Example",
    'sendemail'    => "Send Email example",
  );
  $items = array();
  foreach ($examples as $key => $value) {
    $items[] = l($value, "illuminate-example/" . $key);
  }

  $output = theme("item_list", array("items" => $items));

  return $output;
}

function illuminate_example_detail_page($group) {
  $fn = 'illuminate_example_'.$group;
  if (function_exists($fn)){
    return $fn();
  }

  return $fn . ":: Not found.";
}

function illuminate_example_cache(){

  $cachedata = Cache::remember('illuminate_example_cache', 1/6, function(){
      return "Now is:" . date("Y-m-d h:i:s");
  });

  return "Cache data in 10 seconds::" . $cachedata;
}

function illuminate_example_yamlconfig(){
  $config = YAML::load('illuminate_example');
  // Get all config variables.
  dpm($config->obtain());
  // Get config with a key.
  if($con_vars = $config->get('name')){
    dpm($con_vars);
  }

  return "Loaded yaml config";
}

function illuminate_example_drupalassets(){
  DrupalAssets::addCSS("{module-illuminate_example}/theme/mytheme.css");

  return "DrupalAssets test, load css change style of " . check_plain('<h1>');
}

function illuminate_example_drupalconfig(){
  $output = array();
  $output[] = "Put value for illuminate_example::key-1";
  DrupalConfig::put("illuminate_example", "key-1", "value-1");

  $output[] = ("Put value for illuminate_example::key-2");
  DrupalConfig::put("illuminate_example", "key-2", "value-2");

  $output[] = ("illuminate_example::key-1::" . DrupalConfig::get("illuminate_example", "key-1"));
  $output[] = ("illuminate_example::key-2::" . DrupalConfig::get("illuminate_example", "key-2"));

  $output[] = ("Remove illuminate_example::key-1");
  DrupalConfig::forget("illuminate_example", "key-1");
  $output[] = ("illuminate_example::key-1::" . DrupalConfig::get("illuminate_example", "key-1"));
  $output[] = ("All illuminate_example keys");
  $output[] = (DrupalConfig::all("illuminate_example"));

  $output[] = ("Remove all illuminate_example keys");
  DrupalConfig::flush("illuminate_example");
  $output[] = ("Check illuminate_example keys::");

  $output[] = (DrupalConfig::all("illuminate_example"));

  return implode("<br />", $output);
}

/**
 * Example view render.
 *
 * @return string
 */
function illuminate_example_viewrender() {
  $template = illuminate_realpath('{module-illuminate_example}/theme/mytheme.tpl.php');

  return ViewRender::make($template, array("name" => "HKT"))->render();
}


function illuminate_example_sendemail() {
  $data = array('firstname' => 'HKT');
  $template = illuminate_realpath('{module-illuminate_example}/theme/welcome.tpl.php');
  Mail::send($template, $data, function($message) {
      $message->to('flashvnn@gmail.com', 'Flash Vnn')->subject('Welcome Laravel!');
  });

  return "Send mail complete";
}
